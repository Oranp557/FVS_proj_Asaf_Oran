MODULE main
VAR
    move : {l,u,r,d};
    man_c : 1..11;
    man_r : 1..10;
    box_1_c : 1..11;
    box_1_r : 1..10;
    box_2_c : 1..11;
    box_2_r : 1..10;
    goal_1_c : 1..11;
    goal_1_r : 1..10;
    goal_2_c : 1..11;
    goal_2_r : 1..10;
    walls : array 1..10 of array 1..11 of 0..1;
ASSIGN
    init(man_c) := 4;
    init(man_r) := 5;
    init(box_1_c) := 3;
    init(box_1_r) := 4;
    init(box_2_c) := 8;
    init(box_2_r) := 6;
    goal_1_c := 8;
    goal_1_r := 3;
    goal_2_c := 8;
    goal_2_r := 6;
    walls[1][1] := 1;
    walls[1][2] := 1;
    walls[1][3] := 1;
    walls[1][4] := 1;
    walls[1][5] := 1;
    walls[1][6] := 1;
    walls[1][7] := 1;
    walls[1][8] := 1;
    walls[1][9] := 1;
    walls[1][10] := 1;
    walls[1][11] := 1;
    walls[2][1] := 1;
    walls[2][2] := 0;
    walls[2][3] := 0;
    walls[2][4] := 0;
    walls[2][5] := 0;
    walls[2][6] := 0;
    walls[2][7] := 0;
    walls[2][8] := 1;
    walls[2][9] := 1;
    walls[2][10] := 1;
    walls[2][11] := 1;
    walls[3][1] := 1;
    walls[3][2] := 0;
    walls[3][3] := 0;
    walls[3][4] := 1;
    walls[3][5] := 0;
    walls[3][6] := 0;
    walls[3][7] := 0;
    walls[3][8] := 0;
    walls[3][9] := 1;
    walls[3][10] := 1;
    walls[3][11] := 1;
    walls[4][1] := 1;
    walls[4][2] := 0;
    walls[4][3] := 0;
    walls[4][4] := 0;
    walls[4][5] := 0;
    walls[4][6] := 0;
    walls[4][7] := 0;
    walls[4][8] := 0;
    walls[4][9] := 1;
    walls[4][10] := 1;
    walls[4][11] := 1;
    walls[5][1] := 1;
    walls[5][2] := 0;
    walls[5][3] := 0;
    walls[5][4] := 0;
    walls[5][5] := 1;
    walls[5][6] := 0;
    walls[5][7] := 0;
    walls[5][8] := 0;
    walls[5][9] := 1;
    walls[5][10] := 1;
    walls[5][11] := 1;
    walls[6][1] := 1;
    walls[6][2] := 1;
    walls[6][3] := 1;
    walls[6][4] := 0;
    walls[6][5] := 0;
    walls[6][6] := 0;
    walls[6][7] := 0;
    walls[6][8] := 0;
    walls[6][9] := 1;
    walls[6][10] := 1;
    walls[6][11] := 1;
    walls[7][1] := 1;
    walls[7][2] := 1;
    walls[7][3] := 1;
    walls[7][4] := 1;
    walls[7][5] := 1;
    walls[7][6] := 0;
    walls[7][7] := 0;
    walls[7][8] := 0;
    walls[7][9] := 0;
    walls[7][10] := 0;
    walls[7][11] := 1;
    walls[8][1] := 1;
    walls[8][2] := 1;
    walls[8][3] := 1;
    walls[8][4] := 1;
    walls[8][5] := 1;
    walls[8][6] := 1;
    walls[8][7] := 1;
    walls[8][8] := 0;
    walls[8][9] := 0;
    walls[8][10] := 0;
    walls[8][11] := 1;
    walls[9][1] := 1;
    walls[9][2] := 1;
    walls[9][3] := 1;
    walls[9][4] := 1;
    walls[9][5] := 1;
    walls[9][6] := 1;
    walls[9][7] := 1;
    walls[9][8] := 0;
    walls[9][9] := 0;
    walls[9][10] := 0;
    walls[9][11] := 1;
    walls[10][1] := 1;
    walls[10][2] := 1;
    walls[10][3] := 1;
    walls[10][4] := 1;
    walls[10][5] := 1;
    walls[10][6] := 1;
    walls[10][7] := 1;
    walls[10][8] := 1;
    walls[10][9] := 1;
    walls[10][10] := 1;
    walls[10][11] := 1;
next(man_c) :=
    case
        move = r & (mv_r | push_r) & (man_c < 11) : man_c + 1;
        move = l & (mv_l | push_l) & (man_c > 1) : man_c - 1;
        move = u : man_c;
        move = d : man_c;
        TRUE : man_c;
    esac;
next(man_r) :=
    case
        move = r : man_r;
        move = l : man_r;
        move = u & (mv_u | push_u) & (man_r > 1) : man_r - 1;
        move = d & (mv_d | push_d) & (man_r < 10) : man_r + 1;
        TRUE : man_r;
    esac;
next(box_1_c) :=
    case
        push_l & box_1_on_l & (box_1_c < 11) : box_1_c - 1;
        push_r & box_1_on_r & (box_1_c > 1) : box_1_c + 1;
        TRUE: box_1_c;
    esac;
next(box_1_r) :=
    case
        push_u & box_1_on_t & (box_1_r > 1) : box_1_r - 1;
        push_d & box_1_on_b & (box_1_r < 10) : box_1_r + 1;
        TRUE: box_1_r;
    esac;
next(box_2_c) :=
    case
        push_l & box_2_on_l & (box_2_c < 11) : box_2_c - 1;
        push_r & box_2_on_r & (box_2_c > 1) : box_2_c + 1;
        TRUE: box_2_c;
    esac;
next(box_2_r) :=
    case
        push_u & box_2_on_t & (box_2_r > 1) : box_2_r - 1;
        push_d & box_2_on_b & (box_2_r < 10) : box_2_r + 1;
        TRUE: box_2_r;
    esac;
DEFINE
    mv_r := (move = r) & (man_c < 11) & (walls[man_r][man_c + 1] = 0) & !box_1_on_r & !box_2_on_r;
    mv_l := (move = l) & (man_c > 1) & (walls[man_r][man_c - 1] = 0) & !box_1_on_l & !box_2_on_l;
    mv_u := (move = u) & (man_r > 1) & (walls[man_r - 1][man_c] = 0) & !box_1_on_t & !box_2_on_t;
    mv_d := (move = d) & (man_r < 10) & (walls[man_r + 1][man_c] = 0) & !box_1_on_b & !box_2_on_b;
    box_1_on_r := (man_c + 1 = box_1_c) & (man_r = box_1_r);
    box_1_on_rp1 := (man_c + 2 = box_1_c) & (man_r = box_1_r);
    box_1_on_l := (man_c - 1 = box_1_c) & (man_r = box_1_r);
    box_1_on_lp1 := (man_c - 2 = box_1_c) & (man_r = box_1_r);
    box_1_on_t := (man_c = box_1_c) & (man_r - 1 = box_1_r);
    box_1_on_tp1 := (man_c = box_1_c) & (man_r - 2 = box_1_r);
    box_1_on_b := (man_c = box_1_c) & (man_r + 1 = box_1_r);
    box_1_on_bp1 := (man_c = box_1_c) & (man_r + 2 = box_1_r);
    box_2_on_r := (man_c + 1 = box_2_c) & (man_r = box_2_r);
    box_2_on_rp1 := (man_c + 2 = box_2_c) & (man_r = box_2_r);
    box_2_on_l := (man_c - 1 = box_2_c) & (man_r = box_2_r);
    box_2_on_lp1 := (man_c - 2 = box_2_c) & (man_r = box_2_r);
    box_2_on_t := (man_c = box_2_c) & (man_r - 1 = box_2_r);
    box_2_on_tp1 := (man_c = box_2_c) & (man_r - 2 = box_2_r);
    box_2_on_b := (man_c = box_2_c) & (man_r + 1 = box_2_r);
    box_2_on_bp1 := (man_c = box_2_c) & (man_r + 2 = box_2_r);
    push_r := (move = r) & (walls[man_r][man_c + 2] = 0) & ((box_1_on_r & !box_2_on_rp1) | (box_2_on_r & !box_1_on_rp1));
    push_l := (move = l) & (walls[man_r][man_c - 2] = 0) & ((box_1_on_l & !box_2_on_lp1) | (box_2_on_l & !box_1_on_lp1));
    push_u := (move = u) & (walls[man_r - 2][man_c] = 0) & ((box_1_on_t & !box_2_on_tp1) | (box_2_on_t & !box_1_on_tp1));
    push_d := (move = d) & (walls[man_r + 2][man_c] = 0) & ((box_1_on_b & !box_2_on_bp1) | (box_2_on_b & !box_1_on_bp1));
    win := ((box_1_c = goal_1_c & box_1_r = goal_1_r) | (box_1_c = goal_2_c & box_1_r = goal_2_r)) & ((box_2_c = goal_1_c & box_2_r = goal_1_r) | (box_2_c = goal_2_c & box_2_r = goal_2_r));
LTLSPEC !F win;
